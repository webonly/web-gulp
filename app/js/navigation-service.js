!function(e){this.NavigationService=e()}(function(){function e(){this.version="v2.1.0";var e,t,s,n,i=null,o=null,a=0,c=0,r={Navigation:"navigation",Gmapping:"gmapping",Coverting:"converting",Cancel:"cancel",GamppingPose:"gmapping_pose",SaveMap:"save_map",SaveMapEdit:"save_map_edit",SaveAsMap:"save_as_map",SaveAsMapEdit:"save_as_map_edit",Userauth:"user_auth",Map_Select:"dbparam-select",Map_Delete:"dbparam-delete",Map_Update:"dbparam-update",Map_Insert:"dbparam-insert",Update:"update",Roslog_delete:"roslog-delete",Roslog_select:"roslog-select",Shutdown:"shutdown",Reboot:"reboot",Version:"version"},p={ChargeUp:'rostopic pub -1 /auto_charge std_msgs/Byte "1"',ChargeDown:'rostopic pub -1 /auto_charge std_msgs/Byte "0"',Joystick:'_JOYSTICK=`rosnode list | grep teleop_joystic`; if [[ -n $_JOYSTICK ]]; then _FB="joy_on"; else _FB="joy_off"; fi; rostopic pub -1 /shell_feedback std_msgs/String $_FB',JoystickOn:"roslaunch bringup teleop_joystick.launch",JoystickOff:"rosnode kill /teleop_joystick",MapSaveStaus:'roslaunch bringup map_edit_as_saver.launch; rostopic pub -1 /shell_feedback std_msgs/String "map_edit_ok"',PLCopen:'rostopic pub -1 /waypoint_user_pub std_msgs/String "wangjin_open"',PLCclose:'rostopic pub -1 /waypoint_user_pub std_msgs/String "wangjin_close"',PLCstatus:'rostopic pub -1 /waypoint_user_pub std_msgs/String "wangjin_status"',Version:"_RC=`grep '\\''|'\\'' ~/catkin_ws/README.md`;_FB=`echo $_RC | awk -F '\\''|'\\'' '\\''{print $10}'\\''`;_FB=`echo version:$_FB | awk -F '\\'' '\\'' '\\''{print $1$2}'\\''`;rostopic pub -1 /shell_feedback std_msgs/String $_FB;unset _FB; unset _RC;"},u={cmdTopic:{name:"/cmd_string",messageType:"std_msgs/String"},shellTopic:{name:"/shell_string",messageType:"std_msgs/String"},updateTopic:{name:"/system_shell/shell_string",messageType:"std_msgs/String"},imuTopic:{name:"/mobile_imu",messageType:"sensor_msgs/Imu"},velTopic:{name:"/cmd_vel",messageType:"geometry_msgs/Twist"},odomTopic:{name:"/odom",messageType:"nav_msgs/Odometry"},poseTopic:{name:"/robot_pose",messageType:"geometry_msgs/Pose"},diagnosticsTopic:{name:"/diagnostics_agg",messageType:"diagnostic_msgs/DiagnosticArray"},map_editTopic:{name:"/map_edit",messageType:"nav_msgs/OccupancyGrid"},map_edit_asTopic:{name:"/map_edit_as",messageType:"nav_msgs/OccupancyGrid"},waypointTopic:{name:"/waypoints",messageType:"yocs_msgs/WaypointList"},trajectoryTopic:{name:"/trajectories",messageType:"yocs_msgs/TrajectoryList"},waypoint_addTopic:{name:"/waypoint_add",messageType:"yocs_msgs/Waypoint"},waypoint_removeTopic:{name:"/waypoint_remove",messageType:"yocs_msgs/Waypoint"},trajectory_addTopic:{name:"/trajectory_add",messageType:"yocs_msgs/Trajectory"},trajectory_removeTopic:{name:"/trajectory_remove",messageType:"yocs_msgs/Trajectory"},nav_ctrlTopic:{name:"/nav_ctrl",messageType:"yocs_msgs/NavigationControl"},nav_ctrl_statusTopic:{name:"/nav_ctrl_status",messageType:"yocs_msgs/NavigationControlStatus"},shell_feedbackTopic:{name:"/shell_feedback",messageType:"std_msgs/String"}},l={Navigation:"navigation",Gmapping:"gmapping",Coverting:"converting"},h=(new Array,new Array,null),m=function(){return new ROSLIB.ActionClient({ros:i,actionName:"move_base_msgs/MoveBaseAction",serverName:"/move_base"})},g=function(e){return new ROSLIB.Message({data:e})},d=function(e,t){return new ROSLIB.Message({header:{frame_id:"/map",seq:0},info:e,data:t})},v=function(e,t,s,n){return new ROSLIB.Pose({position:{x:e,y:t,z:0},orientation:{x:0,y:0,z:s,w:n}})},_=function(e){return new ROSLIB.Goal({actionClient:m(),goalMessage:{target_pose:{header:{frame_id:"/map"},pose:e}}})},f=function(e,t){return new ROSLIB.Message({linear:{x:e,y:0,z:0},angular:{x:0,y:0,z:t}})},y=function(e){return new ROSLIB.Topic({ros:i,name:e.name,messageType:e.messageType})},T=function(e,t){for(var e=y(e),s=1;s<arguments.length;s++){var n=g(arguments[s]);e.publish(n)}};this.startPostion=v(0,0,0,1),this.navModeStatus=l,this.navModeStatus.navStatus="/Other/ros_mode",this.Init=function(e){var t=e.url||"ws://"+window.location.hostname+":9090";i=new ROSLIB.Ros,i.connect(t),i.on("connection",e.onopen||function(){console.log("connect server %s success",t)}),i.on("close",e.onclose||function(){console.error("connect server %s close",t)}),i.on("error",e.onerror||function(){console.error("connect server %s error",t)})},this.ShowMap=function(e,t,s){document.getElementById(s).innerHTML="";var n=new ROS2D.Viewer({divID:s,width:e,height:t,background:"#7e7e7e"});NAV2D.OccupancyGridClientNav({ros:i,rootObject:n.scene,continuous:!0,withOrientation:!0,viewer:n,serverName:"/move_base"});return n.scene},this.RemoveMap=function(e){document.getElementById(e).innerHTML=""},this.Gmapping=function(){T(u.cmdTopic,r.Gmapping)},this.Navigation=function(){T(u.cmdTopic,r.Navigation)},this.SaveMap=function(){T(u.cmdTopic,r.GamppingPose,r.SaveMap,r.SaveMapEdit)},this.ShowMapEdit=function(s,n){e=s,t=n,mapEditdiv=document.getElementById(e),mapEditdiv.style.overflow="auto";var i=y(u.map_editTopic);i.subscribe(function(e){o=e,i.unsubscribe();var s=document.getElementById(t),n=s.getContext("2d");s.width=e.info.width,s.height=e.info.height;for(var a=n.createImageData(s.width,s.height),c=0;c<s.height;c++)for(var r=0;r<s.width;r++){var p,u=r+(s.height-c-1)*s.width,l=e.data[u];p=100===l?0:0===l?255:127;var h=4*(r+c*s.width);a.data[h]=p,a.data[++h]=p,a.data[++h]=p,a.data[++h]=255}n.putImageData(a,0,0)})},this.SaveMapEdit=function(){mapEditCanvas=document.getElementById(t);for(var e=new Array,s=mapEditCanvas.getContext("2d"),n=mapEditCanvas,i=s.getImageData(0,0,n.width,n.height),a=0;a<n.height;a++)for(var c=0;c<n.width;c++){var p=c+(n.height-a-1)*n.width,l=4*(c+a*n.width);switch(i.data[l]){case 0:e[p]=100;break;case 255:e[p]=0;break;case 127:e[p]=-1;break;default:e[p]=100}}T(u.cmdTopic,r.SaveAsMapEdit);var h=d(o.info,e),m=y(u.map_edit_asTopic);m.publish(h)},this.goPostion=function(e,t){n=_(e),n.send(),n.on("status",t)},this.UnSubscribeGoal=function(e){n.off("status",e)},this.Cancel=function(){T(u.cmdTopic,r.Cancel)},this.goFront=function(){var e=y(u.velTopic);null!=h&&(clearInterval(h),h=null),h=setInterval(function(){e.publish(f(.25,0))},300)},this.goBack=function(){var e=y(u.velTopic);null!=h&&(clearInterval(h),h=null),h=setInterval(function(){e.publish(f(-.25,0))},300)},this.goLeft=function(){var e=y(u.velTopic);null!=h&&(clearInterval(h),h=null),h=setInterval(function(){e.publish(f(0,.25))},300)},this.goRight=function(){var e=y(u.velTopic);null!=h&&(clearInterval(h),h=null),h=setInterval(function(){e.publish(f(0,-.25))},300)},this.goStop=function(){var e=y(u.velTopic);null!=h&&(clearInterval(h),h=null),e.publish(f(0,0))},this.Subscribe_feedbackTopic=function(e){var t=y(u.shell_feedbackTopic);t.subscribe(e)};var b;this.Subscribe_poseTopic=function(e){b=y(u.poseTopic),b.subscribe(e)},this.UnSubscribe_poseTopic=function(){b.unsubscribe()};var w;this.Subscribe_diagnosticsTopic=function(e){w=y(u.diagnosticsTopic),w.subscribe(e)},this.UnSubscribe_diagnosticsTopic=function(){w.unsubscribe()},this.OpenHandle=function(){T(u.shellTopic,p.JoystickOn,p.Joystick)},this.CloseHandle=function(){T(u.shellTopic,p.JoystickOff,p.Joystick)},this.GetHandleStatus=function(){T(u.shellTopic,p.Joystick)},this.Shutdown=function(){T(u.cmdTopic,r.Shutdown)},this.Reboot=function(){T(u.cmdTopic,r.Reboot)},this.Version=function(){T(u.cmdTopic,r.Version)},this.FixCanvas=function(){document.getElementById(e).style.overflow="hidden"},this.UnFixCanvas=function(){document.getElementById(e).style.overflow="auto"},this.Paint={init:function(){this.x=[],this.y=[],this.clickDrag=[],this.lock=!1,this.storageColor="#000000",this.eraserRadius=10,this.canvas=document.getElementById(t),this.cxt=this.canvas.getContext("2d"),this.cxt.lineJoin="round",this.cxt.lineWidth=6,this.w=this.canvas.width,this.h=this.canvas.height,this.touch="createTouch"in document,this.StartEvent=this.touch?"touchstart":"mousedown",this.MoveEvent=this.touch?"touchmove":"mousemove",this.EndEvent=this.touch?"touchend":"mouseup",this.bind(),s=document.getElementById(e),s.onscroll=function(){a=s.scrollTop,c=s.scrollLeft}},bind:function(){var e=this;this.canvas["on"+e.StartEvent]=function(t){var s=e.touch?t.touches[0]:t,n=s.clientX-s.target.offsetLeft+c,i=s.clientY-s.target.offsetTop+a;e.isEraser?e.resetEraser(n,i,s):(e.movePoint(n,i),e.drawPoint()),e.lock=!0},this.canvas["on"+e.MoveEvent]=function(t){var s=e.touch?t.touches[0]:t;if(e.lock){var n=s.clientX-s.target.offsetLeft+c,i=s.clientY-s.target.offsetTop+a;e.isEraser?e.resetEraser(n,i,s):(e.movePoint(n,i,!0),e.drawPoint())}},this.canvas["on"+e.EndEvent]=function(t){e.lock=!1,e.x=[],e.y=[],e.clickDrag=[],clearInterval(e.Timer),e.Timer=null}},movePoint:function(e,t,s){this.x.push(e),this.y.push(t),this.clickDrag.push(t)},drawPoint:function(e,t,s){for(var n=0;n<this.x.length;n++)this.cxt.beginPath(),this.clickDrag[n]&&n?this.cxt.moveTo(this.x[n-1],this.y[n-1]):this.cxt.moveTo(this.x[n]-1,this.y[n]),this.cxt.lineTo(this.x[n],this.y[n]),this.cxt.closePath(),this.cxt.stroke()}}}return e.debugAll=!1,e});